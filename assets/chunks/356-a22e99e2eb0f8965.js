"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[356],{36397:function(e,n,t){t.d(n,{L:function(){return i}});var r=t(82729),o=t(49989);function s(){let e=(0,r._)([""]);return s=function(){return e},e}let i=(0,t(90948).ZP)(o.Z)(s())},99565:function(e,n,t){t.d(n,{a:function(){return s}});var r=t(67294),o=t(3127);let s=()=>(0,r.useContext)(o.Vo)},356:function(e,n,t){t.d(n,{A:function(){return ei}});var r,o=t(85893),s=t(67294),i=t(39332),l=t(90948),a=t(11163),c=t(45697),d=t.n(c),p=t(3127),h=t(64352);let u=e=>{let{children:n}=e,t=(0,a.useRouter)(),{isAuthenticated:r}=(0,p.Eu)(),o=(0,s.useRef)(!1),[i,l]=(0,s.useState)(!1),c=()=>{window.open("".concat(h.Z.apiUrl,"/cas/login/"),"_self")},d=async()=>{try{let e=await fetch("".concat(h.Z.apiUrl,"/session/"));if(e.ok){let n=await e.json();if(console.log(n),n.authenticated)return window.sessionStorage.setItem("user",JSON.stringify(n.user)),window.sessionStorage.setItem("sessionKey",n.session_key),window.sessionStorage.setItem("isNew",n.new),!0}else console.error("Failed to fetch session data:",e.statusText);return!1}catch(e){return console.error("Error fetching session data:",e),!1}};return((0,s.useEffect)(()=>{t.isReady&&!o.current&&(o.current=!0,r?l(!0):d().then(e=>{e?(window.sessionStorage.setItem("authenticated",!0),window.location.reload()):c()}))},[t.isReady]),i)?n:null};u.propTypes={children:d().node};var x=t(41664),f=t.n(x),j=t(60662),g=t(61237),m=t(5616),Z=t(15861),b=t(53219),y=t(67720),w=t(51233),C=t(77533),v=t(2734);let k=()=>{let e=(0,v.Z)().palette.primary.main;return(0,o.jsx)("img",{alt:"Logo",src:"https://liphy-annuaire.univ-grenoble-alpes.fr/static/images/app/liphy-logo.png",height:"100%",width:"100%",style:{fill:e}})};var R=t(36397),S=t(49773),P=t(94781),z=t(52823),E=t(91065),F=t(27636),I=t(16230);let _=[{title:"Dashboard",path:"/",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(S.Z,{})})},{title:"Inventory",path:"/materials",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(E.Z,{})})},{title:"My Loans",path:"/myloans",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(P.Z,{})})},{title:"My Materials",path:"/mymaterials",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(F.Z,{})})},{title:"Account",path:"/account",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(z.Z,{})})},{title:"Threads",path:"/comments",icon:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(I.Z,{})})}];var T=t(49990);let q=e=>{let{active:n=!1,disabled:t,external:r,icon:s,path:i,title:l}=e,a=i?r?{component:"a",href:i,target:"_blank"}:{component:f(),href:i}:{};return(0,o.jsx)("li",{children:(0,o.jsxs)(T.Z,{sx:{alignItems:"center",borderRadius:1,display:"flex",justifyContent:"flex-start",pl:"16px",pr:"16px",py:"6px",textAlign:"left",width:"100%",...n&&{backgroundColor:"rgba(255, 255, 255, 0.04)"},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)"}},...a,children:[s&&(0,o.jsx)(m.Z,{component:"span",sx:{alignItems:"center",color:"neutral.400",display:"inline-flex",justifyContent:"center",mr:2,...n&&{color:"primary.main"}},children:s}),(0,o.jsx)(m.Z,{component:"span",sx:{color:"neutral.400",flexGrow:1,fontFamily:e=>e.typography.fontFamily,fontSize:14,fontWeight:600,lineHeight:"24px",whiteSpace:"nowrap",...n&&{color:"common.white"},...t&&{color:"neutral.500"}},children:l})]})})};q.propTypes={active:d().bool,disabled:d().bool,external:d().bool,icon:d().node,path:d().string,title:d().string.isRequired};var N=t(99565);let M=e=>{let n=(0,N.a)().user,{open:t,onClose:r}=e,s=(0,i.usePathname)(),l=(0,g.Z)(e=>e.breakpoints.up("lg")),a=(0,o.jsx)(R.L,{sx:{height:"100%","& .simplebar-content":{height:"100%"},"& .simplebar-scrollbar:before":{background:"neutral.400"}},children:(0,o.jsxs)(m.Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,o.jsxs)(m.Z,{sx:{p:3},children:[(0,o.jsx)(m.Z,{component:f(),href:"/",sx:{display:"inline-flex",minHeight:50,maxHeight:75,minWidth:50,maxWidth:75},children:(0,o.jsx)(k,{})}),(0,o.jsxs)(m.Z,{sx:{alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.04)",borderRadius:1,cursor:"pointer",display:"flex",justifyContent:"space-between",mt:2,p:"12px"},children:[(0,o.jsx)("div",{children:(0,o.jsx)(Z.Z,{color:"inherit",variant:"subtitle1",children:"Matostheque"})}),(0,o.jsx)(b.Z,{fontSize:"small",sx:{color:"neutral.500"},children:(0,o.jsx)(j.Z,{})})]})]}),(0,o.jsx)(y.Z,{sx:{borderColor:"neutral.700"}}),(0,o.jsx)(m.Z,{component:"nav",sx:{flexGrow:1,px:2,py:3},children:(0,o.jsx)(w.Z,{component:"ul",spacing:.5,sx:{listStyle:"none",p:0,m:0},children:_.map(e=>{let t=!!e.path&&s===e.path;if("/mymaterials"!==e.path||"owner"===n.role)return(0,o.jsx)(q,{active:t,disabled:e.disabled,external:e.external,icon:e.icon,path:e.path,title:e.title},e.title)})})}),(0,o.jsx)(y.Z,{sx:{borderColor:"neutral.700"}}),(0,o.jsx)(m.Z,{sx:{px:2,py:3},children:(0,o.jsx)(Z.Z,{color:"neutral.100",variant:"subtitle2",children:"Ver. 1.0.0 "})})]})});return l?(0,o.jsx)(C.ZP,{anchor:"left",open:!0,PaperProps:{sx:{backgroundColor:"neutral.800",color:"common.white",width:280}},variant:"permanent",children:a}):(0,o.jsx)(C.ZP,{anchor:"left",onClose:r,open:t,PaperProps:{sx:{backgroundColor:"neutral.800",color:"common.white",width:280}},sx:{zIndex:e=>e.zIndex.appBar+100},variant:"temporary",children:a})};M.propTypes={onClose:d().func,open:d().bool};var O=t(93806),D=t(44149),L=t(93946),A=t(34386),H=t(90263),U=t(69661),W=t(41796);function B(){let e=(0,s.useRef)(null),[n,t]=(0,s.useState)(!1),r=(0,s.useCallback)(()=>{t(!0)},[]);return{anchorRef:e,handleClose:(0,s.useCallback)(()=>{t(!1)},[]),handleOpen:r,handleToggle:(0,s.useCallback)(()=>{t(e=>!e)},[]),open:n}}var V=t(14564),G=t(84118),J=t(30431);let K=e=>{let{anchorEl:n,onClose:t,open:r}=e,l=(0,i.useRouter)(),a=(0,N.a)(),c=a.user,d=(0,s.useCallback)(()=>{null==t||t(),a.signOut()},[t,a,l]);return(0,o.jsxs)(V.ZP,{anchorEl:n,anchorOrigin:{horizontal:"left",vertical:"bottom"},onClose:t,open:r,PaperProps:{sx:{width:200}},children:[c?(0,o.jsxs)(m.Z,{sx:{py:1.5,px:2},children:[(0,o.jsx)(Z.Z,{variant:"overline",children:"Account"}),(0,o.jsxs)(Z.Z,{color:"text.secondary",variant:"body2",children:[c.first_name," ",c.last_name]}),(0,o.jsxs)(Z.Z,{color:"text.secondary",variant:"caption",children:[c.role," account"]})]}):null,(0,o.jsx)(y.Z,{}),(0,o.jsx)(G.Z,{disablePadding:!0,dense:!0,sx:{p:"8px","& > *":{borderRadius:1}},children:(0,o.jsx)(J.Z,{onClick:d,children:"Sign out"})})]})};K.propTypes={anchorEl:d().any,onClose:d().func,open:d().bool.isRequired};var Q=t(66242),X=t(78445),Y=t(44267),$=t(70008);let ee={Read:"#F0F0F0",Unread:"#F0F0F0"},en=e=>{let{notification:n}=e,t=(0,$.F)(n.created_at);return(0,o.jsxs)(Q.Z,{sx:{py:1,mb:1,bgcolor:"".concat(ee[n.status]),borderRadius:"0px",border:"1px solid #f0f0f0"},children:[(0,o.jsx)(X.Z,{subheader:0==t?"Today":"".concat(t),sx:{py:0}}),(0,o.jsx)(Y.Z,{style:{paddingTop:0,paddingBottom:0},children:(0,o.jsx)(Z.Z,{variant:"body1",color:"textPrimary",children:n.description})})]})};en.propTypes={notification:d().shape({description:d().string.isRequired,created_at:d().string.isRequired,type:d().string.isRequired}).isRequired};let et=e=>{let{anchorEl:n,onClose:t,open:r}=e,[l,a]=(0,s.useState)(null),c=(0,i.useRouter)(),d=(0,N.a)(),p=d.user,u=(0,s.useCallback)(()=>{null==t||t(),c.push("/notifications")},[t,d,c]);return(0,s.useEffect)(()=>{fetch("".concat(h.Z.apiUrl,"/notifications/").concat(p.user_id,"/")).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{a(null==e?void 0:e.slice(0,3))}).catch(e=>{console.error("Error fetching data:",e)})},[]),(0,o.jsxs)(V.ZP,{anchorEl:n,anchorOrigin:{horizontal:"left",vertical:"bottom"},onClose:t,open:r,PaperProps:{sx:{width:500}},children:[p?(0,o.jsx)(m.Z,{sx:{py:2,px:2},children:l&&l.length>0?l.map(e=>(0,o.jsx)(en,{notification:e},e.notif_id)):(0,o.jsx)(Z.Z,{variant:"subtitle2",children:"No notification to show."})}):null,(0,o.jsx)(y.Z,{}),(0,o.jsx)(G.Z,{disablePadding:!0,dense:!0,sx:{p:"8px","& > *":{borderRadius:1}},children:(0,o.jsx)(J.Z,{onClick:u,children:"View all"})})]})};et.propTypes={anchorEl:d().any,onClose:d().func,open:d().bool.isRequired};let er=e=>{let{onNavOpen:n}=e,t=(0,g.Z)(e=>e.breakpoints.up("lg")),r=B(),s=B(),i=(0,N.a)().user.profil_pic,l=i?"".concat("https://liphy-annuaire.univ-grenoble-alpes.fr/static/","/").concat(i[0]):"";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Z,{component:"header",sx:{backdropFilter:"blur(6px)",backgroundColor:e=>(0,W.Fq)(e.palette.background.default,.8),position:"sticky",left:{lg:"".concat(280,"px")},top:0,width:{lg:"calc(100% - ".concat(280,"px)")},zIndex:e=>e.zIndex.appBar},children:(0,o.jsxs)(w.Z,{alignItems:"center",direction:"row",justifyContent:"space-between",spacing:2,sx:{minHeight:64,px:2},children:[(0,o.jsx)(w.Z,{alignItems:"center",direction:"row",spacing:2,children:!t&&(0,o.jsx)(L.Z,{onClick:n,children:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(D.Z,{})})})}),(0,o.jsxs)(w.Z,{alignItems:"center",direction:"row",spacing:2,children:[(0,o.jsx)(A.Z,{title:"Notifications",children:(0,o.jsx)(L.Z,{onClick:s.handleOpen,ref:s.anchorRef,children:(0,o.jsx)(H.Z,{badgeContent:4,color:"success",variant:"dot",children:(0,o.jsx)(b.Z,{fontSize:"small",children:(0,o.jsx)(O.Z,{})})})})}),(0,o.jsx)(U.Z,{onClick:r.handleOpen,ref:r.anchorRef,sx:{cursor:"pointer",height:40,width:40},src:l})]})]})}),(0,o.jsx)(K,{anchorEl:r.anchorRef.current,open:r.open,onClose:r.handleClose}),(0,o.jsx)(et,{anchorEl:s.anchorRef.current,open:s.open,onClose:s.handleClose})]})};er.propTypes={onNavOpen:d().func};let eo=(0,l.ZP)("div")(e=>{let{theme:n}=e;return{display:"flex",flex:"1 1 auto",maxWidth:"100%",[n.breakpoints.up("lg")]:{paddingLeft:280}}}),es=(0,l.ZP)("div")({display:"flex",flex:"1 1 auto",flexDirection:"column",width:"100%"}),ei=(r=e=>{let{children:n}=e,t=(0,i.usePathname)(),[r,l]=(0,s.useState)(!1),a=(0,s.useCallback)(()=>{r&&l(!1)},[r]);return(0,s.useEffect)(()=>{a()},[t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(er,{onNavOpen:()=>l(!0)}),(0,o.jsx)(M,{onClose:()=>l(!1),open:r}),(0,o.jsx)(eo,{children:(0,o.jsx)(es,{children:n})})]})},e=>(0,o.jsx)(u,{children:(0,o.jsx)(r,{...e})}))},70008:function(e,n,t){t.d(n,{F:function(){return r}});let r=e=>{let n=(new Date-new Date(e))/1e3;return n<60?Math.round(n)+" seconds ago":n<3600?Math.round(n/60)+" minutes ago":n<86400?Math.round(n/3600)+" hours ago":Math.round(n/86400)+" days ago"}}}]);