(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{95458:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return n(85891)}])},85891:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var a=n(85893),s=n(9008),r=n.n(s),l=n(5616),o=n(65582),i=n(51233),c=n(15861),d=n(27400),u=n(356),x=n(67294),h=n(66242),m=n(44267),p=n(69661),f=n(67720),j=n(62023),g=n(69417),Z=n(55678),y=n(64352),_=n(99565),w=n(42952),b=n(75012);let C=e=>{let t=(0,_.a)(),n={...e},s=n.profil_pic,r=s?"".concat("https://liphy-annuaire.univ-grenoble-alpes.fr/static/","/").concat(s[0]):"",[o,i]=(0,x.useState)([]),[d,u]=(0,x.useState)(!1),C=(0,x.useCallback)(async()=>{if(!o){Z.Am.error("No picture selected!",{autoClose:!1});return}let n=new FormData;if(n.append("image",o),!n.has("image")){console.error("No image file added to FormData");return}try{let a=await fetch("".concat(y.Z.apiUrl,"/users/upload_pictures/").concat(e.user_id,"/"),{method:"POST",body:n});if(a.ok)Z.Am.success("Pictures uploaded successfully!",{autoClose:!1}),await t.updateUser(e.user_id),window.location.reload();else{let e=await a.text(),t=JSON.parse(e);Z.Am.error(t.message,{autoClose:!1})}}catch(e){Z.Am.error("Error trying to upload pictures: ".concat(e),{autoClose:!1})}},[o]);return(0,a.jsxs)(h.Z,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,a.jsx)(m.Z,{sx:{flexGrow:1},children:(0,a.jsxs)(l.Z,{sx:{alignItems:"center",display:"flex",flexDirection:"column"},children:[(0,a.jsx)(p.Z,{src:r,sx:{height:80,mb:2,width:80}}),(0,a.jsxs)(c.Z,{gutterBottom:!0,variant:"h5",children:[n.first_name," ",n.last_name]}),(0,a.jsxs)(c.Z,{color:"text.secondary",variant:"body2",children:[n.role," account"]}),(0,a.jsx)(c.Z,{color:"text.secondary",variant:"body2",children:n.email})]})}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)(j.Z,{sx:{justifyContent:"space-between"},children:[(0,a.jsxs)(g.Z,{variant:"text",component:"label",htmlFor:"upload-button",color:d?"success":"primary",sx:{paddingX:0,display:"flex",alignItems:"center",gap:1,marginRight:1},children:[d?(0,a.jsx)(b.Z,{width:"25px",height:"25px",sx:{color:"success.main"}}):(0,a.jsx)(w.Z,{width:"25px",height:"25px"}),(0,a.jsx)("span",{style:{width:"120px"},children:d?"File Selected":"Choose Picture"}),(0,a.jsx)("input",{id:"upload-button",type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files.length>0){let t=e.target.files[0];u(!0),i(t)}else u(!1)},style:{display:"none"}})]}),(0,a.jsx)(g.Z,{onClick:C,variant:"outlined",children:"Upload"})]})]})};var v=n(78445),A=n(21177),k=n(45843);let S=e=>{let t=(0,_.a)(),n=t.session_token,[s,r]=(0,x.useState)({...e}),[o,i]=(0,x.useState)("owner"==s.role),[u,p]=(0,x.useState)({first_name:null,last_name:null,contact:null,role:null}),w=(0,x.useCallback)(e=>{r(t=>({...t,[e.target.name]:e.target.value}))},[]),b=(0,x.useCallback)(async a=>{a.preventDefault(),u.role=o?"owner":"user";try{let a=await fetch("".concat(y.Z.apiUrl,"/users/").concat(e.user_id,"/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:n},body:JSON.stringify(u)});if(a.ok){let e=await a.json();await t.updateUser(e.user_id),Z.Am.success("Your information was successfully updated!"),window.location.reload()}else{let e=await a.text(),n=JSON.parse(e);"Session expired"===n.error?(Z.Am.error("Your session has expired. Please log in again.",{autoClose:!1}),setTimeout(()=>{t.signOut()},3e3)):"User not found"===n.message?Z.Am.error("User not found. Please try again.",{autoClose:!1}):"Session token not found"===n.message?Z.Am.error("Session token not found. Please try again.",{autoClose:!1}):Z.Am.error("An error occurred. Please try again later.",{autoClose:!1})}}catch(e){console.error("An unexpected error occurred:",e),Z.Am.error("An unexpected error occurred. Please try again later.",{autoClose:!1})}},[u,o,e]);return(0,x.useEffect)(()=>{p({first_name:s.first_name,last_name:s.last_name,contact:s.owner_contact,role:s.role})},[s]),(0,a.jsx)("form",{autoComplete:"off",noValidate:!0,onSubmit:b,children:(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(v.Z,{subheader:"The information can be edited",title:"Profile"}),(0,a.jsx)(m.Z,{sx:{pt:0},children:(0,a.jsx)(l.Z,{sx:{m:-1.5},children:(0,a.jsxs)(d.Z,{container:!0,spacing:3,children:[(0,a.jsx)(d.Z,{xs:12,md:6,children:(0,a.jsx)(A.Z,{fullWidth:!0,label:"First name",name:"first_name",onChange:w,value:s.first_name})}),(0,a.jsx)(d.Z,{xs:12,md:6,children:(0,a.jsx)(A.Z,{fullWidth:!0,label:"Last name",name:"last_name",onChange:w,value:s.last_name})}),(0,a.jsx)(d.Z,{xs:12,md:6,children:(0,a.jsx)(A.Z,{fullWidth:!0,label:"Email Address",name:"email",onChange:w,disabled:!0,value:s.email})}),o?(0,a.jsx)(d.Z,{xs:12,md:6,children:(0,a.jsx)(A.Z,{type:"number",fullWidth:!0,label:"Phone Number",name:"owner_contact",onChange:w,value:s.owner_contact,placeholder:"Ex. 0612354525",InputLabelProps:{shrink:!0}})}):null,(0,a.jsxs)(d.Z,{xs:12,md:6,children:[(0,a.jsx)(k.Z,{checked:o,onChange:()=>{i(!o)},color:"primary",inputProps:{"aria-label":"toggle checkbox"}}),(0,a.jsx)(c.Z,{variant:"caption",color:"textSecondary",children:"Activate Owner Account"})]})]})})}),(0,a.jsx)(f.Z,{}),(0,a.jsx)(j.Z,{sx:{justifyContent:"flex-end"},children:(0,a.jsx)(g.Z,{type:"submit",variant:"contained",children:"Save details"})})]})})},P=()=>{let e=(0,_.a)().user;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{children:(0,a.jsx)("title",{children:"Account"})}),(0,a.jsx)(l.Z,{component:"main",sx:{flexGrow:1,py:8},children:(0,a.jsx)(o.Z,{maxWidth:"lg",children:(0,a.jsxs)(i.Z,{spacing:3,children:[(0,a.jsx)("div",{children:(0,a.jsx)(c.Z,{variant:"h4",children:"Account"})}),(0,a.jsx)("div",{children:(0,a.jsxs)(d.Z,{container:!0,spacing:3,children:[(0,a.jsx)(d.Z,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(C,{...e})}),(0,a.jsx)(d.Z,{item:!0,xs:12,md:6,lg:8,children:(0,a.jsx)(S,{...e})})]})})]})})})]})};P.getLayout=e=>(0,a.jsx)(u.A,{children:e});var N=P}},function(e){e.O(0,[839,294,589,740,360,54,754,356,774,888,179],function(){return e(e.s=95458)}),_N_E=e.O()}]);