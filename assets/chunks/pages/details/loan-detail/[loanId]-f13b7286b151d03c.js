(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{70385:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/details/loan-detail/[loanId]",function(){return t(44542)}])},78175:function(e,a,t){"use strict";t.d(a,{I:function(){return o}});var n=t(85893),l=t(45697),r=t.n(l);let i=(0,t(90948).ZP)("span")(e=>{let{theme:a,ownerState:t}=e;return{alignItems:"center",backgroundColor:a.palette[t.color].alpha12,borderRadius:12,color:"dark"===a.palette.mode?a.palette[t.color].main:a.palette[t.color].dark,cursor:"default",display:"inline-flex",flexGrow:0,flexShrink:0,fontFamily:a.typography.fontFamily,fontSize:a.typography.pxToRem(12),lineHeight:2,fontWeight:600,justifyContent:"center",letterSpacing:.5,minWidth:20,paddingLeft:a.spacing(1),paddingRight:a.spacing(1),textTransform:"uppercase",whiteSpace:"nowrap"}}),o=e=>{let{color:a="primary",children:t,...l}=e;return(0,n.jsx)(i,{ownerState:{color:a},...l,children:t})};o.propTypes={children:r().node,color:r().oneOf(["primary","secondary","error","info","warning","success","amber","teal","orange","blue","gray"])}},27403:function(e,a,t){"use strict";t.d(a,{$d:function(){return s},Jb:function(){return l},Yq:function(){return o},d9:function(){return c},fo:function(){return r},ql:function(){return i},vI:function(){return n}});let n=[{value:"",label:"None"},{value:"Pending Validation",label:"Pending Validation"},{value:"Overdue",label:"Overdue"},{value:"Borrowed",label:"Borrowed"},{value:"Closed",label:"Closed"},{value:"Canceled",label:"Canceled"},{value:"Rejected",label:"Rejected"},{value:"Booked",label:"Booked"}],l={"Pending Validation":"blue",Overdue:"warning",Borrowed:"primary",Closed:"teal",Canceled:"amber",Rejected:"warning",Booked:"secondary"},r=["MOVE","LAME","BIOP","MICROTISS","ECCEL","MC2","PSM","MODI","OPTIMA","KAPAH","SECR","IT"],i=[{value:"LAB_SUPPLIES",label:"Lab Supplies"},{value:"CONSUMABLES",label:"Consumables"}],o=[{value:"FILTERS_FILTRATION_SUPPLIES",label:"Filters and Filtration Supplies"},{value:"BIOLOGICAL_CONSUMABLES",label:"Biological Consumables"},{value:"CHEMICALS",label:"Chemicals"},{value:"SAFETY_EQUIPMENT",label:"Safety Equipment"},{value:"LAB_FURNITURE_FIXTURES",label:"Lab Fixtures"},{value:"CLEANING_MAINTENANCE_SUPPLIES",label:"Cleaning and Maintenance Supplies"}],s=[{value:"GENERAL_SUPPLIES",label:"General Supplies"},{value:"BUILDINGS_INFRASTRUCTURE_WORKS_GREEN_SPACES",label:"Building, Infrastructure, Works and Green spaces"},{value:"COMMUNICATION_CULTURE_DOCUMENTATION",label:"Communication, Culture and Documentation"},{value:"TRAVEL_TRANSPORT_ACCOMMODATION",label:"Travel : Transport and Accomodation "},{value:"STUDIES_CONSULTING_INSURANCE_PI_HUMAN_RESOURCES",label:"Studies, Consulting, Insurance and Human Resources"},{value:"FREIGHT_SHIPPING_TRANSPORT_MOVING",label:"Freight, Shipping, Transport and Moving"},{value:"LABORATORY_WORKSHOP_GASES_CRYOGENICS",label:"Laboratories or Workshop Gases and Cryogenics "},{value:"HYGIENE_SAFETY",label:"Hygiene and Safety at Work"},{value:"IT_TELECOMMUNICATIONS_AUDIOVISUAL",label:"IT, Telecommunications and Audiovisual"},{value:"LABORATORY_TP_ROOM_FITTINGS",label:"Laboratory and TP Room Fittings "},{value:"ANIMAL_EXPERIMENTATION_ANIMAL_BREEDING_ANIMAL_CONSERVATION_ANIMAL_STUDIES",label:"Animal Experimentation, Animal Breeding, Animal Conservation and Animal Studies"},{value:"MEDICAL",label:"Mecidal"},{value:"MICROSCOPY_PROFILOMETRY",label:"Microscopy and Profilometry"},{value:"CHEMISTRY_BIOLOGY",label:"Chemistry and Biology"},{value:"OPTO_LASERS_OPTICAL_EQUIPMENT",label:"Opto, Lasers and Optical Equipement"},{value:"PHYSICS_NUCLEAR_CORPUSCULAR_PHYSICS",label:"Physics, Nuclear and Corpuscular Physics"},{value:"PLANT_EXPERIMENTATION",label:"Plant Experimentation"},{value:"WORKSHOP_MECHANICS_AUTOMATION",label:"Workshop, Mechanics and Automation"},{value:"SPECTROMETRY_SPECTROSCOPY_X-RAYS",label:"Spectrometry, Spectroscopy and X-rays"},{value:"ELECTRONICS_TEST_ENERGY_MEASUREMENT",label:"Electronics or Tests, Energy and Measurement"},{value:"ARTH_SCIENCES_GEOPHYSICS_ASTROPHYSICS_ARCHAEOLOGY",label:"Arth Sciences, Geophysics, Astrophysics and Archaeology"},{value:"VACUUM_VACUUM_TECHNOLOGY_EQUIPMENT",label:"Vacuum and Vacuum Technology Equipment"},{value:"NANOTECHNOLOGIES_MICROELECTRONICS",label:"Nanotechnologies and Microelectronics"},{value:"NON_PURCHASING_EXPENSES",label:"Non Purchasing Expenses"}],c=[{value:"M",label:"Meter"},{value:"KG",label:"Kilogram"},{value:"G",label:"Gram"},{value:"L",label:"Liter"},{value:"ML",label:"Milliliter"},{value:"PC",label:"Piece"}]},44542:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return W}});var n=t(85893),l=t(9008),r=t.n(l),i=t(5616),o=t(65582),s=t(51233),c=t(15861),d=t(69417),u=t(53219),h=t(27400),_=t(13898),m=t(22536),p=t(40253),w=t(356),S=t(66242),v=t(44267),x=t(11791),f=t(21177),y=t(46901),E=t(67720),g=t(62023),b=t(72882),j=t(7906),C=t(295),I=t(53816),T=t(98102),O=t(78175),A=t(89204),Z=t(67294),L=t(64352),N=t(39332),R=t(33931),M=t(71501),P=t(99565);let U=e=>{let a=(0,N.useRouter)(),t=(0,P.a)().user,[n,l]=(0,Z.useState)(null),[r,i]=(0,Z.useState)(""),[o,s]=(0,Z.useState)(!1),[c,d]=(0,Z.useState)(null),{addNotification:u}=(0,M.l)(),[h,_]=(0,Z.useState)({location:"",duration:null}),[m,p]=(0,Z.useState)({status:null,value:""});(0,Z.useEffect)(()=>{e&&["Borrowed","Booked","Pending Validation","Overdue"].includes(e.loan_status)&&s(!0)},[e]);let w=(0,Z.useCallback)(async()=>!(h.duration>e.material_details.duration)||(p({status:"error",value:"The new loan term should be less than or equal to ".concat(e.material_details.duration," days.")}),!1),[h,e.material_details.duration]),S=(0,Z.useCallback)(e=>{let a=(null==e?void 0:e.is_user_owner)?"You have":" ".concat(null==e?void 0:e.borrower_name," has"),t=(null==e?void 0:e.is_user_owner)?"The owner has":"You have";u({message:"".concat(a," updated the location of the loaned material: ").concat(null==e?void 0:e.material_title),notificationType:"General",priority:"Low",title:"Loan Update",user:null==e?void 0:e.owner_user_id,loan:null==e?void 0:e.loan}),u({message:"".concat(t," updated the location of the loaned material: ").concat(null==e?void 0:e.material_title),notificationType:"General",priority:"Low",title:"Loan Update",user:null==e?void 0:e.borrower_id,loan:null==e?void 0:e.loan})},[u]);(0,Z.useEffect)(()=>{e&&(l((0,R.p)(e.loan_date)),_(a=>({...a,duration:e.duration,location:e.location})))},[e]);let v=(0,Z.useCallback)(async a=>{a.preventDefault(),h.duration=parseInt(h.duration),await w().then(async a=>{if(a)try{let a=await fetch("".concat(L.Z.apiUrl,"/loans/").concat(e.loan_id,"/"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(a.ok)await a.json(),p({status:"success",value:"Loan updated successfully!"}),S({material_title:e.material_details.title,borrower_id:e.borrower_details.user_id,borrower_name:"".concat(e.borrower_details.first_name," ").concat(e.borrower_details.last_name),owner_user_id:e.owner_details.user_id,is_user_owner:t.user_id===e.owner_details.user_id,is_staff:t.is_staff,loan:e.loan_id}),setTimeout(()=>{window.location.reload()},1e3);else{let e=await a.text(),t=JSON.parse(e);p({status:"error",value:t.message})}}catch(e){p({status:"error",value:"Error trying to submit loan: ".concat(e)})}})}),x=(0,Z.useCallback)(async t=>{t.preventDefault();try{let t=await fetch("".concat(L.Z.apiUrl,"/loans/").concat(e.loan_id,"/"),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(t.ok)await t.json(),p({status:"success",value:"Record deleted successfully!"}),setTimeout(()=>{a.push("/loans"),window.location.reload()},3e3);else{let e=await t.text(),a=JSON.parse(e);p({status:"error",value:a.message})}}catch(e){p({status:"error",value:"Error trying to delete loan: ".concat(e)})}},[h,e.loan_id,a]);return{formattedDate:n,daysLeft:r,editableRow:c,formData:h,message:m,handleChange:e=>{_(a=>({...a,[e.target.name]:e.target.value}))},handleEdit:e=>{d(e)},handleSave:()=>{d(null)},handleSaveChanges:v,handleDelete:x,enableEdit:o}};var k=t(27403);let G=e=>{let a=(0,P.a)().user;(0,N.useRouter)();let t=e.data?e.data:null,{formattedDate:l,daysLeft:r,editableRow:o,formData:u,message:h,handleChange:_,handleEdit:p,handleSave:w,handleSaveChanges:Z,handleDelete:L,enableEdit:R}=U(t);return t?(0,n.jsxs)(S.Z,{children:[(0,n.jsx)(v.Z,{children:(0,n.jsxs)(i.Z,{sx:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center"},gap:1,children:[t?(0,n.jsx)(b.Z,{component:x.Z,children:(0,n.jsx)(j.Z,{sx:{minWidth:200},"aria-label":"information table",children:(0,n.jsxs)(C.Z,{children:[(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Material Title"}),(0,n.jsx)(T.Z,{style:{minWidth:160},align:"left",children:t.material_details.title})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Duration (in days)"}),(0,n.jsx)(T.Z,{id:"duration",style:{minWidth:160},align:"left",children:t.duration})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Status"}),(0,n.jsx)(T.Z,{style:{minWidth:160},align:"left",children:(0,n.jsxs)(s.Z,{direction:"rows",alignItems:"center",gap:1,children:[(0,n.jsx)(O.I,{color:k.Jb[t.loan_status],children:t.loan_status}),(0,n.jsx)("p",{children:r?"( ".concat(r," )"):null})]})})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Borrower"}),(0,n.jsxs)(T.Z,{style:{minWidth:160},align:"left",children:[t.borrower_details.first_name," ",t.borrower_details.last_name]})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Loan starting date"}),(0,n.jsx)(T.Z,{style:{minWidth:160},align:"left",children:l})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Team"}),(0,n.jsx)(T.Z,{style:{minWidth:160},align:"left",children:t.material_details.team})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Loan Location"}),(0,n.jsx)(T.Z,{id:"team",style:{minWidth:160},align:"left",children:(0,n.jsxs)(s.Z,{direction:"rows",alignItems:"center",gap:1,children:["location"===o?(0,n.jsx)(f.Z,{name:"location",value:u.location,onChange:_}):u.location,R?"location"===o?(0,n.jsx)(d.Z,{onClick:w,children:(0,n.jsx)(m.Z,{style:{width:20,height:20}})}):(0,n.jsx)(d.Z,{onClick:()=>p("location"),children:(0,n.jsx)(A.Z,{style:{width:20,height:20}})}):null]})})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Owner"}),(0,n.jsxs)(T.Z,{style:{minWidth:160},align:"left",children:[t.owner_details.first_name," ",t.owner_details.last_name]})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",children:"Owner's Email"}),(0,n.jsx)(T.Z,{style:{minWidth:160},align:"left",children:t.owner_details.email})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(T.Z,{component:"th",variant:"head",scope:"row",style:{verticalAlign:"top"},children:"Borrower's Note"}),(0,n.jsx)(T.Z,{style:{minWidth:160,whiteSpace:"pre-line"},align:"left",children:t.message})]})]})})}):(0,n.jsx)(c.Z,{variant:"subtitle.2",children:" ...Loading data"}),h&&h.status?(0,n.jsx)(s.Z,{xs:12,md:6,children:(0,n.jsxs)(y.Z,{severity:h.status,children:[" ",h.value]})}):null]})}),R?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{}),(0,n.jsx)(g.Z,{sx:{justifyContent:"center"},children:(0,n.jsx)(d.Z,{type:"submit",onClick:Z,variant:"contained",children:"Save changes"})})]}):null,(0,n.jsx)(E.Z,{}),a.is_staff?(0,n.jsx)(g.Z,{sx:{justifyContent:"center"},children:(0,n.jsx)(d.Z,{variant:"contained",color:"error",onClick:L,children:"Delete loan record"})}):null]}):(0,n.jsx)(S.Z,{children:(0,n.jsx)(v.Z,{children:(0,n.jsx)(c.Z,{gutterBottom:!0,variant:"h5",children:"No material found!!"})})})};var Y=t(11163);t(41664);var B=t(55678);let D=e=>{let a=(0,P.a)().user,{addNotification:t}=(0,M.l)(),[n,l]=(0,Z.useState)(null),[r,i]=(0,Z.useState)(!1),[o,s]=(0,Z.useState)(!1),[c,d]=(0,Z.useState)(!1),[u,h]=(0,Z.useState)(!1);(0,Z.useEffect)(()=>{n&&(h(a&&(a.user_id===n.borrower||a.user_id===n.owner_details.user_id||a.is_staff)),i(a&&a.user_id===n.owner_details.user_id),s(a&&a.user_id===n.borrower),d(a&&n.owner_details.user_id===a.user_id))},[a,n]);let _=(0,Z.useCallback)(e=>{let{owner_user_id:a,borrower_id:n,ownerMessage:l,borrowerMessage:r,priority:i,title:o,loan:s}=e,{owner_priority:c,borrower_priority:d}=i;a!==n&&(t({message:l,notificationType:"Event",user:a,priority:c,title:o,loan:s}),t({message:r,notificationType:"Event",user:n,priority:d,title:o,loan:s}))},[t]),m=async(e,a,t,l,r,i)=>{try{let{genericMessage:o,ownerMessage:s,borrowerMessage:c}=l,d=await fetch("".concat(L.Z.apiUrl,"/loans/").concat(e,"/"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({[t]:new Date().toISOString(),...a})});if(d.ok)await d.json(),B.Am.success(o),_({borrower_id:n.borrower_details.user_id,owner_user_id:n.owner_details.user_id,ownerMessage:s,borrowerMessage:c,priority:r,title:i,loan:e}),setTimeout(()=>{window.location.reload()},3e3);else{let e=await d.text(),a=JSON.parse(e);B.Am.error(a.message)}}catch(e){B.Am.error("Error: ".concat(e))}},p=async()=>{let a="You approved the loan: ".concat(n.material_details.title," by \n                ").concat(n.borrower_details.first_name," ").concat(n.borrower_details.last_name,"."),t="Your request to borrow: ".concat(n.material_details.title," was approved.");await m(e,{},"approval_date",{genericMessage:"Loan approved successfully!",ownerMessage:a,borrowerMessage:t},{owner_priority:c?"Low":"High",borrower_priority:c?"Low":"High"},"Loan Approval")},w=async()=>{let a="You rejected the loan: ".concat(n.material_details.title," by \n                ").concat(n.borrower_details.first_name," ").concat(n.borrower_details.last_name,"."),t="Your request to borrow: ".concat(n.material_details.title," was rejected.");await m(e,{},"rejection_date",{genericMessage:"Loan rejected successfully!",ownerMessage:a,borrowerMessage:t},{owner_priority:c?"Low":"Medium",borrower_priority:c?"Low":"Medium"},"Loan Rejection")},S=async()=>{let a="Request Cancelled: ".concat(n.material_details.title," by \n                ").concat(n.borrower_details.first_name," ").concat(n.borrower_details.last_name,"."),t="You cancelled your request to borrow: ".concat(n.material_details.title,".");await m(e,{},"cancellation_date",{genericMessage:"Loan cancelled successfully!",ownerMessage:a,borrowerMessage:t},{owner_priority:c?"Medium":"Low",borrower_priority:c?"Low":"Medium"},"Loan Cancellation")},v=async()=>{let a="Your material: ".concat(n.material_details.title," was returned by \n                ").concat(n.borrower_details.first_name," ").concat(n.borrower_details.last_name,"."),t="You returned the material: ".concat(n.material_details.title,".");await m(e,{is_active:!1},"return_date",{genericMessage:"Loan returned successfully!",ownerMessage:a,borrowerMessage:t},{owner_priority:c?"Medium":"Low",borrower_priority:c?"Low":"Medium"},"Material Return")};return(0,Z.useEffect)(()=>{e&&fetch("".concat(L.Z.apiUrl,"/loans/details/").concat(e)).then(e=>e.json()).then(e=>{l(e[0])}).catch(e=>console.error("Error fetching data:",e))},[e]),{loanData:n,user:a,authorization:u,isOwner:r,isBorrower:o,OnApproveClick:p,OnRejectClick:w,OnCancelClick:S,OnReturnClick:v}},H=()=>{let{loanId:e}=(0,Y.useRouter)().query,{loanData:a,user:t,authorization:l,isOwner:w,isBorrower:S,OnApproveClick:v,OnRejectClick:x,OnCancelClick:f,OnReturnClick:y}=D(e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r(),{children:(0,n.jsx)("title",{children:"Loan Details"})}),(0,n.jsx)(i.Z,{component:"main",sx:{flexGrow:1,py:8},children:(0,n.jsx)(o.Z,{maxWidth:"lg",children:l?(0,n.jsxs)(s.Z,{spacing:3,children:[(0,n.jsxs)(s.Z,{sx:{direction:"row",alignItems:"center",justifyContent:"space-between"},spacing:2,direction:"row",children:[(0,n.jsx)(c.Z,{variant:"h4",children:"Loan Details"}),(0,n.jsx)(s.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap",gap:1},children:a&&t&&(0,n.jsxs)(n.Fragment,{children:[S&&("Borrowed"===a.loan_status||"Overdue"===a.loan_status)&&(0,n.jsx)(d.Z,{startIcon:(0,n.jsxs)(u.Z,{fontSize:"small",children:[" ",(0,n.jsx)(_.Z,{})," "]}),variant:"contained",onClick:y,children:"Return"}),w&&"Pending Validation"===a.loan_status&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{startIcon:(0,n.jsxs)(u.Z,{fontSize:"small",children:[" ",(0,n.jsx)(m.Z,{})," "]}),variant:"contained",color:"success",onClick:v,children:"Approve"}),(0,n.jsx)(d.Z,{startIcon:(0,n.jsxs)(u.Z,{fontSize:"small",children:[" ",(0,n.jsx)(p.Z,{})," "]}),variant:"contained",color:"error",onClick:x,children:"Reject"})]}),S&&("Pending Validation"===a.loan_status||"Booked"===a.loan_status)&&(0,n.jsx)(d.Z,{startIcon:(0,n.jsxs)(u.Z,{fontSize:"small",children:[" ",(0,n.jsx)(p.Z,{})," "]}),variant:"contained",color:"error",onClick:f,children:"Cancel"})]})})]}),(0,n.jsx)("div",{children:(0,n.jsx)(h.Z,{container:!0,spacing:3,children:(0,n.jsx)(h.Z,{xs:12,md:10,lg:10,children:(0,n.jsx)(G,{data:a})})})})]}):(0,n.jsx)(c.Z,{variant:"subtitle2",children:"You don't have the authorization to access this page."})})})]})};H.getLayout=e=>(0,n.jsx)(w.A,{children:e});var W=H},33931:function(e,a,t){"use strict";t.d(a,{M:function(){return l},p:function(){return n}});let n=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),l=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}},function(e){e.O(0,[839,294,589,740,360,54,375,437,356,774,888,179],function(){return e(e.s=70385)}),_N_E=e.O()}]);